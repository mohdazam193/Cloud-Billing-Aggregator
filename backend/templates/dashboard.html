<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>
  <h2>Cloud Billing Aggregator</h2>
  <div>
    <a href="/export/csv">Export CSV</a> |
    <a href="/logout">Logout</a>
  </div>
</header>

<main>
  <section class="intro">
    <h1>Cost Insights</h1>
    <p>Spend overview</p>

    <select name="range" onchange="this.form.submit()">
  <option value="1d" {{ 'selected' if range == '1d' else '' }}>Last 1 day</option>
  <option value="30d" {{ 'selected' if range == '30d' else '' }}>Last 30 days</option>
  <option value="60d" {{ 'selected' if range == '60d' else '' }}>Last 60 days</option>
  <option value="90d" {{ 'selected' if range == '90d' else '' }}>Last 90 days</option>
</select>

    </form>
  </section>

  <section class="grid">
    <div class="card">
      <span>Total Spend</span>
      <strong>${{ total }}</strong>
    </div>

    {% if aws_services %}
    <div class="card">
      <span>AWS</span>
      <strong>${{ aws_total }}</strong>
      <em>{{ aws_change }}% {% if aws_trend=='up' %}↑{% elif aws_trend=='down' %}↓{% endif %}</em>
    </div>
    {% endif %}

    {% if azure_services %}
    <div class="card">
      <span>Azure</span>
      <strong>${{ azure_total }}</strong>
      <em>{{ azure_change }}% {% if azure_trend=='up' %}↑{% elif azure_trend=='down' %}↓{% endif %}</em>
    </div>
    {% endif %}
  </section>

  <section class="surface">
    <h3>Spend Distribution</h3>
    <canvas id="chart"></canvas>
  </section>
</main>

<script>
new Chart(document.getElementById('chart'),{
  type:'bar',
  data:{
    labels:['AWS','Azure'],
    datasets:[{
      data:[{{ aws_total }}, {{ azure_total }}],
      backgroundColor:['#2563eb','#9333ea']
    }]
  },
  options:{plugins:{legend:{display:false}}}
});
</script>
</body>
</html>
